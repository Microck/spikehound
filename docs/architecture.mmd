flowchart TD
    AM([Azure Monitor\nCost Alert])
    AW["Webhook\n/api/webhooks/alert"]

    AM --> AW

    CA["Cost Analyst\nCost Management API"]
    RA["Resource Agent\nResource Graph"]
    HA["History Agent\nAI Search / Cosmos DB"]

    AW --> CA & RA & HA

    CF["Unified Findings"]

    CA & RA & HA --> CF

    DA["Diagnosis Agent\nAI Foundry / GPT-4o"]
    CF --> DA

    RP["Remediation Planner"]
    DA --> RP

    SN["Slack"]
    DN["Discord"]

    RP --> SN & DN

    AREC["Approval Record"]
    SN & DN -->|"Approve / Reject / Investigate"| AREC

    GATE{"Remediation Gate"}
    AREC -->|"Approve"| GATE

    REO["Remediation Orchestrator"]
    SAFE["Skipped â€” safe default"]

    GATE -->|"enabled"| REO
    GATE -->|"disabled"| SAFE

    AZ["Azure Compute\nstop_vm"]
    FU["Follow-up Notification"]

    REO --> AZ --> FU

    classDef azure   fill:#e6f3ff,stroke:#0066cc,color:#003d7a
    classDef agent   fill:#f0f7ee,stroke:#3a7d44,color:#1b4332
    classDef human   fill:#fff8e1,stroke:#f9a825,color:#5d4037
    classDef safe    fill:#e8f5e9,stroke:#2e7d32,color:#1b5e20
    classDef neutral fill:#fafafa,stroke:#9e9e9e,color:#212121

    class AM,AZ azure
    class CA,RA,HA,DA,RP agent
    class SN,DN,AREC human
    class SAFE,FU safe
    class CF,REO,GATE,AW neutral
